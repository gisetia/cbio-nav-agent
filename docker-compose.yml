version: "3.9"

services:
  cbio-nav-agent:
    build: .
    ports:
      - "5000:5000"
    env_file:
      - .env
    environment:
      # Override if your MCP server is reachable at a different address.
      MCP_SERVER_URL: ${MCP_SERVER_URL:-http://host.docker.internal:8002/mcp}
      DEFAULT_MODEL: ${DEFAULT_MODEL:-anthropic:claude-sonnet-4-20250514}
      DEFAULT_TEMPERATURE: ${DEFAULT_TEMPERATURE:-0.0}
      DEFAULT_MAX_OUTPUT_TOKENS: ${DEFAULT_MAX_OUTPUT_TOKENS:-1024}
      DEFAULT_CHUNK_SIZE: ${DEFAULT_CHUNK_SIZE:-1200}
      ENABLE_STEP_STREAMING: ${ENABLE_STEP_STREAMING:-true}
      STREAM_TEXT_LIVE: ${STREAM_TEXT_LIVE:-true}
      STREAM_TOOL_NOTICES_LIVE: ${STREAM_TOOL_NOTICES_LIVE:-true}
      STREAM_TOOL_ARGS_LIVE: ${STREAM_TOOL_ARGS_LIVE:-true}
      STREAM_TOOL_RESPONSES_LIVE: ${STREAM_TOOL_RESPONSES_LIVE:-false}
      INCLUDE_FINAL_TEXT: ${INCLUDE_FINAL_TEXT:-true}
      INCLUDE_TOOL_LOGS_FINAL: ${INCLUDE_TOOL_LOGS_FINAL:-false}
      SYSTEM_PROMPT_FILE: ${SYSTEM_PROMPT_FILE:-}
      SIMULATE: ${SIMULATE:-0}
    volumes:
      # Allow editing prompts without rebuilding.
      - ./prompts:/app/prompts:ro
    command: uvicorn cbio_nav_agent.api:app --host 0.0.0.0 --port 5000
